<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gym Dashboard</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#0b0b0c;
      --card:#121214;
      --muted:#9aa0a6;
      --text:#f5f6f7;
      --line:#202124;
      --good:#22c55e;
      --bad:#ef4444;
      --accent:#3b82f6;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
    }
    header{
      padding:16px;
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    h1{margin:0;font-size:20px}
    main{
      padding:16px;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
      gap:16px;
    }
    section{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:12px;
      padding:16px;
    }
    h2{margin:0 0 12px 0;font-size:16px}
    button{
      background:var(--accent);
      border:none;
      color:#fff;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
      font-size:13px;
    }
    button.secondary{
      background:#2a2a2e;
    }
    button.danger{
      background:var(--bad);
    }
    input,select{
      background:#0f0f12;
      border:1px solid var(--line);
      color:var(--text);
      padding:6px;
      border-radius:6px;
      font-size:13px;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }
    th,td{
      border-bottom:1px solid var(--line);
      padding:6px;
      text-align:left;
    }
    .row{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .muted{color:var(--muted)}
    .tabs button{
      margin-right:4px;
      margin-bottom:4px;
    }
    canvas{
      background:#0f0f12;
      border-radius:8px;
      padding:8px;
    }
  </style>
</head>
<body>

<header>
  <h1>üèãÔ∏è Gym Dashboard</h1>
</header>

<main>

<!-- ROUTINE SECTION -->
<section>
  <h2>Routine</h2>

  <div class="row">
    <label>Active Routine:</label>
    <select id="routineSelect"></select>
    <button onclick="newRoutine()">New</button>
    <button class="secondary" onclick="editRoutine()">Edit</button>
  </div>

  <div class="tabs" id="dayTabs"></div>
  <div id="dayWorkout"></div>
</section>

<!-- LIFT LOG -->
<section>
  <h2>Lift Progress Log</h2>

  <div class="row">
    <select id="filterExercise"></select>
    <select id="filterRoutine"></select>
    <input type="date" id="filterFrom">
    <input type="date" id="filterTo">
    <button onclick="searchLogs()">Search</button>
    <button class="secondary" onclick="clearSearch()">Clear</button>
  </div>

  <div class="row" style="margin-top:8px">
    <button onclick="setView('table')">Table View</button>
    <button onclick="setView('graph')">Graph View</button>
    <select id="graphMetric" onchange="renderGraph()">
      <option value="weight">Top Weight</option>
      <option value="e1rm">e1RM</option>
      <option value="volume">Volume</option>
    </select>
  </div>

  <div id="logTableWrap">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Exercise</th>
          <th>Routine</th>
          <th>Top Set</th>
          <th>e1RM</th>
        </tr>
      </thead>
      <tbody id="logTable"></tbody>
    </table>
  </div>

  <div id="logGraphWrap" style="display:none">
    <canvas id="logChart" height="200"></canvas>
    <button style="margin-top:8px" onclick="downloadGraph()">Download Graph</button>
  </div>
</section>

</main>

<!-- ROUTINE EDITOR MODAL -->
<div id="routineModal" style="display:none;position:fixed;inset:0;background:#000a;padding:20px">
  <section style="max-width:600px;margin:auto">
    <h2>Edit Routine</h2>

    <div class="row">
      <label>Name:</label>
      <input id="routineNameInput">
    </div>

    <div class="row" style="margin-top:8px">
      <label>Day:</label>
      <select id="routineDaySelect"></select>
    </div>

    <h3>Exercises</h3>
    <div id="routineExerciseList"></div>

    <div class="row">
      <input id="newExName" placeholder="Exercise name">
      <input id="newExSets" placeholder="Sets" type="number" style="width:70px">
      <input id="newExReps" placeholder="Reps" style="width:80px">
      <input id="newExNotes" placeholder="Notes">
      <button onclick="addExerciseToDay()">Add</button>
    </div>

    <div class="row" style="margin-top:12px">
      <button onclick="saveRoutine()">Save</button>
      <button class="secondary" onclick="closeRoutineModal()">Cancel</button>
    </div>
  </section>
</div>

<script>
/* ===============================
   STORAGE HELPERS
================================ */
const LS = {
  routines:'gym_routines_v1',
  active:'gym_active_routine_v1',
  logs:'gym_lift_logs_v2'
};

const days = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];

const uid = ()=>Math.random().toString(36).slice(2);

/* ===============================
   INIT
================================ */
let routines = JSON.parse(localStorage.getItem(LS.routines)||'{}');
let activeRoutineId = localStorage.getItem(LS.active);

if(!Object.keys(routines).length){
  const id = uid();
  routines[id]={
    id,
    name:'PPL Routine',
    days:Object.fromEntries(days.map(d=>[d,[]]))
  };
  activeRoutineId=id;
  saveRoutines();
}

function saveRoutines(){
  localStorage.setItem(LS.routines,JSON.stringify(routines));
  localStorage.setItem(LS.active,activeRoutineId);
}

function getActiveRoutine(){
  return routines[activeRoutineId];
}

/* ===============================
   ROUTINE UI
================================ */
function renderRoutineSelect(){
  const sel=document.getElementById('routineSelect');
  sel.innerHTML='';
  Object.values(routines).forEach(r=>{
    const o=document.createElement('option');
    o.value=r.id;
    o.textContent=r.name;
    sel.appendChild(o);
  });
  sel.value=activeRoutineId;
  sel.onchange=e=>{
    activeRoutineId=e.target.value;
    saveRoutines();
    renderAll();
  };
}

function renderDayTabs(){
  const wrap=document.getElementById('dayTabs');
  wrap.innerHTML='';
  days.forEach(d=>{
    const b=document.createElement('button');
    b.textContent=d;
    b.onclick=()=>renderDayWorkout(d);
    wrap.appendChild(b);
  });
}

function renderDayWorkout(day){
  const r=getActiveRoutine();
  const list=r.days[day];
  const div=document.getElementById('dayWorkout');
  div.innerHTML=`<h3>${day}</h3>`;
  if(!list.length){
    div.innerHTML+=`<p class="muted">No exercises</p>`;
    return;
  }
  list.forEach(ex=>{
    div.innerHTML+=`<div>${ex.name} ‚Äî ${ex.sets} x ${ex.reps}</div>`;
  });
}

function newRoutine(){
  const id=uid();
  routines[id]={
    id,
    name:'New Routine',
    days:Object.fromEntries(days.map(d=>[d,[]]))
  };
  activeRoutineId=id;
  saveRoutines();
  renderAll();
  openRoutineModal();
}

function editRoutine(){
  openRoutineModal();
}

/* ===============================
   ROUTINE MODAL
================================ */
let editDay='Mon';

function openRoutineModal(){
  document.getElementById('routineModal').style.display='block';
  document.getElementById('routineNameInput').value=getActiveRoutine().name;
  const sel=document.getElementById('routineDaySelect');
  sel.innerHTML='';
  days.forEach(d=>{
    const o=document.createElement('option');
    o.value=d;
    o.textContent=d;
    sel.appendChild(o);
  });
  sel.value=editDay;
  sel.onchange=e=>{
    editDay=e.target.value;
    renderRoutineExerciseList();
  };
  renderRoutineExerciseList();
}

function closeRoutineModal(){
  document.getElementById('routineModal').style.display='none';
}

function renderRoutineExerciseList(){
  const list=getActiveRoutine().days[editDay];
  const div=document.getElementById('routineExerciseList');
  div.innerHTML='';
  list.forEach((ex,i)=>{
    div.innerHTML+=`
      <div class="row">
        <span>${ex.name} (${ex.sets}x${ex.reps})</span>
        <button class="danger" onclick="removeExercise(${i})">X</button>
      </div>`;
  });
}

function addExerciseToDay(){
  const r=getActiveRoutine();
  r.days[editDay].push({
    id:uid(),
    name:newExName.value,
    sets:newExSets.value,
    reps:newExReps.value,
    notes:newExNotes.value
  });
  newExName.value='';
  newExSets.value='';
  newExReps.value='';
  newExNotes.value='';
  saveRoutines();
  renderRoutineExerciseList();
}

function removeExercise(i){
  getActiveRoutine().days[editDay].splice(i,1);
  saveRoutines();
  renderRoutineExerciseList();
}

function saveRoutine(){
  getActiveRoutine().name=document.getElementById('routineNameInput').value;
  saveRoutines();
  closeRoutineModal();
  renderAll();
}

/* ===============================
   LOGS (stub for now)
================================ */
let viewMode='table';
function setView(v){
  viewMode=v;
  document.getElementById('logTableWrap').style.display=v==='table'?'block':'none';
  document.getElementById('logGraphWrap').style.display=v==='graph'?'block':'none';
  if(v==='graph') renderGraph();
}
function searchLogs(){}
function clearSearch(){}
function renderGraph(){}
function downloadGraph(){}

/* ===============================
   RENDER ALL
================================ */
function renderAll(){
  renderRoutineSelect();
  renderDayTabs();
  renderDayWorkout('Mon');
}
renderAll();
</script>

</body>
</html>
